<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Âá∫Â∫´Á•®„ÉªÊåáÂõ≥Êõ∏„Éï„Ç©„Éº„É† | Modern Edition</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <style>
        /* ===================================
           CSS Variables & Design Tokens
           =================================== */
        :root {
            /* Primary Colors */
            --primary-50: #eef2ff;
            --primary-100: #e0e7ff;
            --primary-200: #c7d2fe;
            --primary-500: #6366f1;
            --primary-600: #4f46e5;
            --primary-700: #4338ca;

            /* Success/Positive */
            --success-50: #ecfdf5;
            --success-100: #d1fae5;
            --success-500: #10b981;
            --success-600: #059669;

            /* Warning */
            --warning-50: #fffbeb;
            --warning-100: #fef3c7;
            --warning-500: #f59e0b;

            /* Danger/Error */
            --danger-50: #fef2f2;
            --danger-500: #ef4444;
            --danger-600: #dc2626;

            /* Info */
            --info-50: #eff6ff;
            --info-500: #3b82f6;

            /* Neutrals */
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-400: #9ca3af;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;

            /* Shadows */
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);

            /* Border Radius */
            --radius-sm: 6px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --radius-xl: 16px;

            /* Transitions */
            --transition-fast: 150ms ease;
            --transition-normal: 250ms ease;
            --transition-slow: 350ms ease;
        }

        /* ===================================
           Reset & Base
           =================================== */
        *,
        *::before,
        *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Noto Sans JP', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 24px;
            color: var(--gray-800);
            line-height: 1.6;
        }

        /* ===================================
           Toast Notification
           =================================== */
        .toast-container {
            position: fixed;
            top: 24px;
            right: 24px;
            z-index: 2000;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .toast {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 20px;
            background: white;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-xl);
            animation: slideInRight 0.3s ease, fadeOut 0.3s ease 2.7s forwards;
            min-width: 280px;
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100px);
            }

            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes fadeOut {
            to {
                opacity: 0;
                transform: translateX(50px);
            }
        }

        .toast-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            flex-shrink: 0;
        }

        .toast.success .toast-icon {
            background: var(--success-100);
            color: var(--success-600);
        }

        .toast.info .toast-icon {
            background: var(--info-50);
            color: var(--info-500);
        }

        .toast.warning .toast-icon {
            background: var(--warning-100);
            color: var(--warning-500);
        }

        .toast-message {
            font-size: 14px;
            font-weight: 500;
            color: var(--gray-700);
        }

        /* ===================================
           Control Panel (Top Bar)
           =================================== */
        .controls {
            width: 210mm;
            max-width: 100%;
            margin-bottom: 20px;
            padding: 16px 24px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-lg);
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 16px;
            flex-wrap: wrap;
            animation: slideDown 0.5s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .controls-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .mode-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 14px;
            background: linear-gradient(135deg, var(--primary-500) 0%, var(--primary-600) 100%);
            color: white;
            border-radius: 50px;
            font-size: 13px;
            font-weight: 500;
            box-shadow: var(--shadow-sm);
        }

        .mode-badge::before {
            content: "‚ú¶";
            font-size: 10px;
        }

        .save-status {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            color: var(--gray-500);
            padding: 4px 10px;
            background: var(--gray-100);
            border-radius: 50px;
        }

        .save-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--success-500);
        }

        .save-indicator.saving {
            animation: pulse 1s infinite;
            background: var(--warning-500);
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }
        }

        .controls-right {
            display: flex;
            gap: 12px;
        }

        /* Buttons */
        .btn {
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            font-family: inherit;
            border: none;
            border-radius: var(--radius-md);
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all var(--transition-normal);
            position: relative;
            overflow: hidden;
        }

        .btn::after {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(to right, transparent, rgba(255, 255, 255, 0.2), transparent);
            transform: translateX(-100%);
            transition: transform 0.5s;
        }

        .btn:hover::after {
            transform: translateX(100%);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-500) 0%, var(--primary-600) 100%);
            color: white;
            box-shadow: 0 4px 14px rgba(99, 102, 241, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(99, 102, 241, 0.5);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success-500) 0%, var(--success-600) 100%);
            color: white;
            box-shadow: 0 4px 14px rgba(16, 185, 129, 0.4);
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.5);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger-500) 0%, var(--danger-600) 100%);
            color: white;
            box-shadow: 0 4px 14px rgba(239, 68, 68, 0.3);
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(239, 68, 68, 0.4);
        }

        .btn-secondary {
            background: var(--gray-100);
            color: var(--gray-700);
            border: 1px solid var(--gray-200);
        }

        .btn-secondary:hover {
            background: var(--gray-200);
            transform: translateY(-1px);
        }

        .btn:active {
            transform: translateY(0) !important;
        }

        .btn-icon {
            width: 16px;
            height: 16px;
        }

        .shortcut-hint {
            font-size: 10px;
            opacity: 0.7;
            margin-left: 4px;
        }

        /* ===================================
           Modal
           =================================== */
        .modal-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.2s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .modal-box {
            background: white;
            padding: 28px;
            border-radius: var(--radius-xl);
            width: 360px;
            max-width: 90%;
            text-align: center;
            box-shadow: var(--shadow-xl);
            animation: scaleIn 0.3s ease;
        }

        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }

            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .modal-icon {
            width: 60px;
            height: 60px;
            margin: 0 auto 16px;
            background: var(--danger-50);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--gray-800);
            margin-bottom: 8px;
        }

        .modal-message {
            font-size: 14px;
            color: var(--gray-500);
            margin-bottom: 24px;
        }

        .modal-actions {
            display: flex;
            gap: 12px;
            justify-content: center;
        }

        /* ===================================
           Paper Container (A4)
           =================================== */
        .container {
            width: 210mm;
            min-height: 297mm;
            background: white;
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-xl);
            padding: 15mm 20mm;
            display: flex;
            flex-direction: column;
            animation: slideUp 0.6s ease;
            position: relative;
            overflow: hidden;
        }

        .container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: linear-gradient(90deg, var(--primary-500), var(--primary-600), #764ba2);
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ===================================
           Section & Header
           =================================== */
        .section {
            width: 100%;
            position: relative;
        }

        .header {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            position: relative;
        }

        .header-title {
            font-size: 22px;
            font-weight: 700;
            color: var(--gray-800);
            position: relative;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }

        .header-title::before {
            content: '';
            width: 4px;
            height: 24px;
            background: linear-gradient(to bottom, var(--primary-500), var(--primary-600));
            border-radius: 2px;
        }

        .section-badge {
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            padding: 4px 12px;
            background: var(--primary-50);
            color: var(--primary-600);
            border-radius: 50px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .serial-no-box {
            position: absolute;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 13px;
            color: var(--gray-500);
        }

        .serial-input {
            width: 130px;
            padding: 6px 12px;
            text-align: right;
            border: 2px solid var(--gray-200);
            border-radius: var(--radius-md);
            font-weight: 600;
            font-size: 14px;
            color: var(--gray-800);
            background: var(--gray-50);
            transition: all var(--transition-fast);
        }

        .serial-input:focus {
            outline: none;
            border-color: var(--primary-500);
            background: white;
            box-shadow: 0 0 0 3px var(--primary-100);
        }

        /* ===================================
           Form Table
           =================================== */
        .form-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            font-size: 13px;
            margin-bottom: 16px;
            border-radius: var(--radius-lg);
            overflow: hidden;
            border: 1px solid var(--gray-200);
            table-layout: fixed;
        }

        .form-table th,
        .form-table td {
            padding: 10px 12px;
            text-align: left;
            vertical-align: middle;
            border-bottom: 1px solid var(--gray-200);
        }

        .form-table th {
            background: linear-gradient(135deg, var(--gray-50) 0%, var(--gray-100) 100%);
            font-weight: 600;
            color: var(--gray-600);
            text-align: center;
            white-space: nowrap;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .form-table td {
            background: white;
        }

        .form-table tr:last-child th,
        .form-table tr:last-child td {
            border-bottom: none;
        }

        .form-table tr:hover td {
            background: var(--gray-50);
        }

        /* Detail Table Header */
        .detail-header {
            background: linear-gradient(135deg, var(--primary-50) 0%, var(--primary-100) 100%) !important;
            color: var(--primary-700) !important;
            font-size: 13px !important;
        }

        .detail-header span {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        /* Product Row */
        .product-row td {
            background: linear-gradient(135deg, var(--gray-50) 0%, white 100%) !important;
            border-left: 3px solid var(--primary-400);
        }

        .product-label {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            color: var(--gray-600);
            font-size: 12px;
            min-width: 60px;
        }

        .product-num {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 22px;
            height: 22px;
            background: var(--primary-500);
            color: white;
            border-radius: 50%;
            font-size: 11px;
            font-weight: 700;
        }

        /* ===================================
           Input Styles
           =================================== */
        input[type="text"],
        input[type="number"],
        input[type="date"],
        select {
            width: 100%;
            padding: 8px 10px;
            border: 1.5px solid var(--gray-200);
            border-radius: var(--radius-sm);
            font-family: inherit;
            font-size: 13px;
            color: var(--gray-800);
            background: white;
            transition: all var(--transition-fast);
        }

        input:focus,
        select:focus {
            outline: none;
            border-color: var(--primary-500);
            box-shadow: 0 0 0 3px var(--primary-100);
            background: white;
        }

        input::placeholder {
            color: var(--gray-400);
            font-size: 12px;
        }

        input[type="number"] {
            text-align: right;
            -moz-appearance: textfield;
        }

        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        select {
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%236b7280'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 8px center;
            background-size: 16px;
            padding-right: 32px;
        }

        /* Auto-calculated fields */
        .auto-calc {
            background: linear-gradient(135deg, var(--warning-50) 0%, var(--warning-100) 100%) !important;
            border-color: var(--warning-500) !important;
            font-weight: 600;
            color: var(--gray-800);
        }

        .readonly-input {
            background: var(--gray-50) !important;
            color: var(--gray-600);
            cursor: default;
            border-color: var(--gray-200);
        }

        .readonly-input:focus {
            box-shadow: none !important;
            border-color: var(--gray-200) !important;
        }

        /* ===================================
           Total Rows
           =================================== */
        .total-row th {
            background: linear-gradient(135deg, var(--gray-100) 0%, var(--gray-200) 100%) !important;
            text-align: right !important;
            font-size: 13px;
            color: var(--gray-700);
        }

        .total-row td {
            background: var(--warning-50) !important;
            font-weight: 700;
        }

        .total-row.grand th {
            background: linear-gradient(135deg, var(--primary-100) 0%, var(--primary-200) 100%) !important;
            color: var(--primary-700);
        }

        .total-row.grand td {
            background: linear-gradient(135deg, var(--primary-50) 0%, var(--primary-100) 100%) !important;
        }

        .total-row.grand input {
            font-size: 15px;
            color: var(--primary-700);
        }

        /* ===================================
           Cut Line
           =================================== */
        .cut-line-container {
            width: 100%;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            margin: 20px 0;
        }

        .cut-line {
            width: 100%;
            border-top: 2px dashed var(--gray-300);
            position: absolute;
            top: 50%;
        }

        .cut-label {
            background: white;
            padding: 4px 16px;
            z-index: 1;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            color: var(--gray-400);
            font-weight: 500;
            border-radius: 50px;
            border: 1px solid var(--gray-200);
        }

        .cut-label .scissors {
            animation: snip 1.5s ease-in-out infinite;
        }

        @keyframes snip {

            0%,
            100% {
                transform: rotate(0deg);
            }

            50% {
                transform: rotate(-10deg);
            }
        }

        /* ===================================
           Instruction Section (Copy)
           =================================== */
        .section.instruction .header-title::before {
            background: linear-gradient(to bottom, var(--success-500), var(--success-600));
        }

        .section.instruction .section-badge {
            background: var(--success-50);
            color: var(--success-600);
        }

        .section.instruction .detail-header {
            background: linear-gradient(135deg, var(--success-50) 0%, rgba(16, 185, 129, 0.15) 100%) !important;
            color: var(--success-600) !important;
        }

        .section.instruction .product-row td {
            border-left-color: var(--success-400);
        }

        .section.instruction .product-num {
            background: var(--success-500);
        }

        /* ===================================
           Keyboard Hint
           =================================== */
        .keyboard-hints {
            position: fixed;
            bottom: 24px;
            left: 24px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 12px 16px;
            border-radius: var(--radius-lg);
            font-size: 12px;
            display: flex;
            gap: 16px;
            opacity: 0.8;
            transition: opacity var(--transition-normal);
        }

        .keyboard-hints:hover {
            opacity: 1;
        }

        .kbd {
            display: inline-block;
            background: rgba(255, 255, 255, 0.2);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: monospace;
            font-weight: 600;
            margin-right: 4px;
        }

        /* ===================================
           Print Styles
           =================================== */
        @media print {
            * {
                box-sizing: border-box;
            }

            body {
                background: white !important;
                padding: 0 !important;
                margin: 0 !important;
                font-size: 10pt !important;
                line-height: 1.4 !important;
            }

            .controls,
            .modal-overlay,
            .toast-container,
            .keyboard-hints {
                display: none !important;
            }

            .container {
                border-radius: 0 !important;
                box-shadow: none !important;
                width: 100% !important;
                max-width: 100% !important;
                margin: 0 !important;
                padding: 8mm 12mm !important;
                min-height: auto !important;
                min-height: 100vh !important;
                height: 100vh !important;
                display: flex !important;
                flex-direction: column !important;
            }

            .container::before {
                display: none !important;
            }

            /* Both sections on same page, equal height */
            .section {
                flex: 1 !important;
                display: flex !important;
                flex-direction: column !important;
                page-break-inside: avoid !important;
            }

            /* Show cut line at center */
            .cut-line-container {
                display: flex !important;
                flex: 0 0 auto !important;
                height: 24px !important;
                margin: 4px 0 !important;
            }

            /* Headers - compact */
            .header {
                margin-bottom: 6px !important;
            }

            .header-title {
                font-size: 14pt !important;
                gap: 6px !important;
            }

            .header-title::before {
                width: 3px !important;
                height: 16px !important;
            }

            .section-badge {
                font-size: 8px !important;
                padding: 2px 8px !important;
            }

            .serial-no-box {
                font-size: 10px !important;
            }

            .serial-input {
                width: 100px !important;
                padding: 2px 6px !important;
                font-size: 10px !important;
            }

            /* Tables - compact for single page */
            .form-table {
                font-size: 8pt !important;
                margin-bottom: 4px !important;
                border-radius: 0 !important;
            }

            .form-table th,
            .form-table td {
                padding: 3px 5px !important;
            }

            .form-table th {
                font-size: 7pt !important;
            }

            .detail-header {
                font-size: 8pt !important;
                padding: 4px 6px !important;
            }

            .detail-header span {
                gap: 4px !important;
            }

            /* Product rows - compact */
            .product-row td {
                padding: 2px 4px !important;
            }

            .product-label {
                font-size: 8pt !important;
                gap: 4px !important;
                min-width: 45px !important;
            }

            .product-num {
                width: 16px !important;
                height: 16px !important;
                font-size: 8px !important;
            }

            /* Inputs - compact */
            input,
            select {
                border: none !important;
                box-shadow: none !important;
                background: transparent !important;
                padding: 2px 3px !important;
                font-size: 8pt !important;
                height: auto !important;
                min-height: 0 !important;
            }

            /* Total rows */
            .total-row th,
            .total-row td {
                padding: 3px 5px !important;
                font-size: 8pt !important;
            }

            .total-row.grand input {
                font-size: 9pt !important;
            }

            /* Cut line - visible and centered */
            .cut-line {
                border-top: 1px dashed #000 !important;
            }

            .cut-label {
                font-size: 9px !important;
                padding: 2px 10px !important;
                gap: 4px !important;
                background: white !important;
            }

            /* Hide price/amount columns in shipping slip (Âá∫Â∫´Á•®) only */
            #shipping-section .hide-on-print,
            #shipping-section .price-col,
            #shipping-section .amount-col,
            #shipping-section .total-row {
                display: none !important;
            }

            /* Color adjustments for print */
            .form-table th,
            .auto-calc,
            .total-row th,
            .total-row td,
            .total-row.grand th,
            .total-row.grand td,
            .product-row td,
            .detail-header,
            .section-badge,
            .product-num {
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }

            /* Prevent page breaks inside tables */
            .form-table,
            .section {
                page-break-inside: avoid !important;
            }

            @page {
                size: A4 portrait;
                margin: 5mm;
            }
        }

        /* ===================================
           Responsive
           =================================== */
        @media (max-width: 800px) {
            body {
                padding: 12px;
            }

            .controls {
                width: 100%;
                padding: 12px 16px;
            }

            .container {
                width: 100%;
                padding: 16px;
                min-height: auto;
            }

            .form-table {
                font-size: 11px;
            }

            .header-title {
                font-size: 18px;
            }

            .serial-no-box {
                position: static;
                transform: none;
                margin-top: 10px;
            }

            .header {
                flex-wrap: wrap;
                justify-content: center;
                gap: 10px;
            }

            .keyboard-hints {
                display: none;
            }
        }
    </style>
</head>

<body>
    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Control Panel -->
    <div class="controls">
        <div class="controls-left">
            <span class="mode-badge">Ê•≠Âãô„Éï„Ç©„Éº„É† v2.0</span>
            <span class="save-status" id="saveStatus">
                <span class="save-indicator" id="saveIndicator"></span>
                <span id="saveText">Ëá™Âãï‰øùÂ≠ò: ON</span>
            </span>
        </div>
        <div class="controls-right">
            <button type="button" class="btn btn-secondary" onclick="loadLastData()" title="ÂâçÂõû„ÅÆ„Éá„Éº„Çø„ÇíÂæ©ÂÖÉ">
                <svg class="btn-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                </svg>
                Âæ©ÂÖÉ
            </button>
            <button type="button" class="btn btn-danger" onclick="openClearModal()">
                <svg class="btn-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                </svg>
                „ÇØ„É™„Ç¢
            </button>

            <button type="button" class="btn btn-primary" onclick="printForm()">
                <svg class="btn-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z" />
                </svg>
                Âç∞Âà∑
                <span class="shortcut-hint">(Ctrl+P)</span>
            </button>
        </div>
    </div>

    <!-- Clear Confirmation Modal -->
    <div id="clearModal" class="modal-overlay">
        <div class="modal-box">
            <div class="modal-icon">‚ö†Ô∏è</div>
            <div class="modal-title">ÂÖ•ÂäõÂÜÖÂÆπ„Çí„ÇØ„É™„Ç¢</div>
            <p class="modal-message">„Åô„Åπ„Å¶„ÅÆÂÖ•ÂäõÂÜÖÂÆπ„ÅåÊ∂àÂéª„Åï„Çå„Åæ„Åô„ÄÇ<br>„Åì„ÅÆÊìç‰Ωú„ÅØÂèñ„ÇäÊ∂à„Åõ„Åæ„Åõ„Çì„ÄÇ</p>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeClearModal()">„Ç≠„É£„É≥„Çª„É´</button>
                <button class="btn btn-danger" onclick="executeClear()">„ÇØ„É™„Ç¢„Åô„Çã</button>
            </div>
        </div>
    </div>

    <!-- Keyboard Hints -->
    <div class="keyboard-hints">
        <span><span class="kbd">Ctrl+P</span> Âç∞Âà∑</span>
        <span><span class="kbd">Esc</span> „É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„Çã</span>
        <span><span class="kbd">Tab</span> Ê¨°„ÅÆ„Éï„Ç£„Éº„É´„Éâ</span>
    </div>

    <!-- Customer Datalist -->
    <datalist id="customer-list"></datalist>

    <!-- Unit Datalist -->
    <datalist id="unit-list">
        <option value="kg">
        <option value="g">
        <option value="ml">
        <option value="L">
        <option value="ÂÄã">
        <option value="Âºè">
        <option value="Êú¨">
        <option value="Âè∞">
        <option value="Âü∫">
        <option value="Êûö">
        <option value="„Çª„ÉÉ„Éà">
        <option value="ÁÆ±">
        <option value="Áº∂">
        <option value="Ë¢ã">
        <option value="EA">
    </datalist>

    <!-- Arrival Date Datalist -->
    <datalist id="arrival-list">
        <option value="Âú®Â∫´ÂìÅ">
        <option value="Âç≥Á¥ç">
        <option value="ÊâãÈÖçÊ∏à„Åø">
        <option value="Âñ∂Ê•≠ÊâãÈÖç">
        <option value="Ë≥ºË≤∑ÊâãÈÖç">
        <option value="ÂÄâÂ∫´ÊâãÈÖç">
        <option value="Áô∫Ê≥®ÂæÖ„Å°">
        <option value="Êú™ÂÆö">
    </datalist>

    <!-- Main Form Container -->
    <div class="container">
        <!-- Upper Section: Shipping Slip -->
        <div class="section" id="shipping-section">
            <div class="header">
                <span class="section-badge">Warehouse</span>
                <h1 class="header-title">Âá∫Â∫´Á•®</h1>
                <div class="serial-no-box">
                    <span>No.</span>
                    <input type="text" id="serial_no" class="serial-input" oninput="handleInput('serial_no')" value="">
                </div>
            </div>

            <!-- Basic Info Table -->
            <table class="form-table">
                <tr>
                    <th style="width: 15%;">ÂèóÊ≥®Êó•</th>
                    <td style="width: 35%;">
                        <input type="date" id="order_date" name="order_date" oninput="handleInput('order_date')">
                    </td>
                    <th style="width: 15%;">Âá∫Ëç∑Êó•</th>
                    <td style="width: 35%;">
                        <input type="date" id="ship_date" name="ship_date" oninput="handleInput('ship_date')">
                    </td>
                </tr>
                <tr>
                    <th>È°ßÂÆ¢ÂÖà</th>
                    <td>
                        <input type="text" id="customer" name="customer" list="customer-list" placeholder="È°ßÂÆ¢Âêç„ÇíÂÖ•Âäõ"
                            oninput="handleInput('customer')">
                    </td>
                    <th>Á¥çÂÖ•ÂÖà</th>
                    <td>
                        <input type="text" id="delivery_place" name="delivery_place" placeholder="Á¥çÂÖ•ÂÖà„ÇíÂÖ•Âäõ"
                            oninput="handleInput('delivery_place')">
                    </td>
                </tr>
            </table>

            <!-- Detail Table -->
            <table class="form-table">
                <thead>
                    <tr>
                        <th colspan="7" class="detail-header">
                            <span>üì¶ ÊòéÁ¥∞</span>
                        </th>
                    </tr>
                    <tr>
                        <th style="width: 10%;">Êï∞Èáè</th>
                        <th style="width: 10%;">Âçò‰Ωç</th>
                        <th style="width: 12%;" class="price-col">Âçò‰æ°</th>
                        <th style="width: 14%;" class="amount-col">ÈáëÈ°ç</th>
                        <th style="width: 14%;">‰ªïÂÖ•ÂÖà</th>
                        <th style="width: 13%;">ÂÖ•Ëç∑‰∫àÂÆöÊó•</th>
                        <th style="width: 27%;">ÂÇôËÄÉ</th>
                    </tr>
                </thead>
                <tbody id="details-body">
                    <!-- Generated by JS -->
                </tbody>
                <tfoot>
                    <tr class="total-row grand">
                        <th colspan="3">ÂêàË®à</th>
                        <td><input type="text" id="grand_total" class="readonly-input" style="text-align:right;"
                                readonly></td>
                        <td colspan="3" style="background:white !important; border:none;"></td>
                    </tr>
                </tfoot>
            </table>
        </div>

        <!-- Cut Line -->
        <div class="cut-line-container">
            <div class="cut-line"></div>
            <div class="cut-label">
                <span class="scissors">‚úÇ</span>
                <span>„Ç≠„É™„Éà„É™„Çª„É≥</span>
            </div>
        </div>

        <!-- Lower Section: Instruction Sheet (Copy) -->
        <div class="section instruction" id="instruction-section">
            <div class="header">
                <span class="section-badge">Office</span>
                <h1 class="header-title">ÊåáÂõ≥Êõ∏</h1>
                <div class="serial-no-box">
                    <span>No.</span>
                    <input type="text" id="serial_no_instruction" class="serial-input readonly-input" readonly>
                </div>
            </div>

            <!-- Basic Info Table -->
            <table class="form-table">
                <tr>
                    <th style="width: 15%;">ÂèóÊ≥®Êó•</th>
                    <td style="width: 35%;">
                        <input type="date" id="order_date_instruction" class="readonly-input" readonly>
                    </td>
                    <th style="width: 15%;">Âá∫Ëç∑Êó•</th>
                    <td style="width: 35%;">
                        <input type="date" id="ship_date_instruction" class="readonly-input" readonly>
                    </td>
                </tr>
                <tr>
                    <th>È°ßÂÆ¢ÂÖà</th>
                    <td>
                        <input type="text" id="customer_instruction" class="readonly-input" readonly>
                    </td>
                    <th>Á¥çÂÖ•ÂÖà</th>
                    <td>
                        <input type="text" id="delivery_place_instruction" class="readonly-input" readonly>
                    </td>
                </tr>
            </table>

            <!-- Detail Table -->
            <table class="form-table">
                <thead>
                    <tr>
                        <th colspan="7" class="detail-header">
                            <span>üìã ÊòéÁ¥∞</span>
                        </th>
                    </tr>
                    <tr>
                        <th style="width: 10%;">Êï∞Èáè</th>
                        <th style="width: 10%;">Âçò‰Ωç</th>
                        <th style="width: 12%;">Âçò‰æ°</th>
                        <th style="width: 14%;">ÈáëÈ°ç</th>
                        <th style="width: 14%;">‰ªïÂÖ•ÂÖà</th>
                        <th style="width: 13%;">ÂÖ•Ëç∑‰∫àÂÆöÊó•</th>
                        <th style="width: 27%;">ÂÇôËÄÉ</th>
                    </tr>
                </thead>
                <tbody id="details-body-instruction">
                    <!-- Generated by JS -->
                </tbody>
                <tfoot>
                    <tr class="total-row grand">
                        <th colspan="3">ÂêàË®à</th>
                        <td><input type="text" id="grand_total_instruction" class="readonly-input"
                                style="text-align:right;" readonly></td>
                        <td colspan="3" style="background:white !important; border:none;"></td>
                    </tr>
                </tfoot>
            </table>
        </div>
    </div>

    <script>
        const MAX_ROWS = 5;
        const STORAGE_KEY = 'businessFormData';
        let saveTimeout = null;

        // ===================================
        // Initialization
        // ===================================
        window.onload = function () {
            renderRows();
            setDefaultDate();
            setInitialSerial();
            loadFromStorage();
            initKeyboardShortcuts();
        };

        // ===================================
        // Toast Notifications
        // ===================================
        function showToast(message, type = 'success') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;

            const icons = {
                success: '‚úì',
                info: '‚Ñπ',
                warning: '‚ö†'
            };

            toast.innerHTML = `
                <div class="toast-icon">${icons[type] || icons.success}</div>
                <span class="toast-message">${message}</span>
            `;

            container.appendChild(toast);

            // Remove after animation
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // ===================================
        // LocalStorage Functions
        // ===================================
        function saveToStorage() {
            const indicator = document.getElementById('saveIndicator');
            indicator.classList.add('saving');

            const data = {};

            // Collect all input values
            document.querySelectorAll('input:not([readonly]), select').forEach(input => {
                if (input.id && !input.id.includes('_instruction')) {
                    data[input.id] = input.value;
                }
            });

            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify({
                    data: data,
                    timestamp: new Date().toISOString()
                }));

                setTimeout(() => {
                    indicator.classList.remove('saving');
                }, 500);
            } catch (e) {
                console.error('Save failed:', e);
            }
        }

        function loadFromStorage() {
            try {
                const stored = localStorage.getItem(STORAGE_KEY);
                if (stored) {
                    const { data, timestamp } = JSON.parse(stored);

                    Object.keys(data).forEach(key => {
                        const input = document.getElementById(key);
                        if (input && data[key]) {
                            input.value = data[key];
                            copyInput(key);
                        }
                    });

                    // Recalculate totals
                    for (let i = 1; i <= MAX_ROWS; i++) {
                        updateRowCalc(i);
                    }
                    calculateTotals();
                }
            } catch (e) {
                console.error('Load failed:', e);
            }
        }

        function loadLastData() {
            loadFromStorage();
            showToast('ÂâçÂõû„ÅÆ„Éá„Éº„Çø„ÇíÂæ©ÂÖÉ„Åó„Åæ„Åó„Åü', 'info');
        }

        // ===================================
        // Keyboard Shortcuts
        // ===================================
        function initKeyboardShortcuts() {
            document.addEventListener('keydown', function (e) {
                // Ctrl+P for print
                if (e.ctrlKey && e.key === 'p') {
                    e.preventDefault();
                    printForm();
                }

                // Escape to close modal
                if (e.key === 'Escape') {
                    closeClearModal();
                }
            });
        }

        // ===================================
        // DOM Rendering
        // ===================================
        function renderRows() {
            const tbody1 = document.getElementById('details-body');
            const tbody2 = document.getElementById('details-body-instruction');
            let html1 = '';
            let html2 = '';

            for (let i = 1; i <= MAX_ROWS; i++) {
                // Original side (editable)
                html1 += `
                    <tr class="product-row">
                        <td colspan="7">
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <span class="product-label">
                                    <span class="product-num">${i}</span>
                                    ÂìÅÂêç
                                </span>
                                <input type="text" id="product_name${i}" name="product_name${i}" 
                                       style="flex: 1;" placeholder="ÂìÅÂêç„ÇíÂÖ•Âäõ" 
                                       oninput="handleInput('product_name${i}')">
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td><input type="number" id="quantity${i}" name="quantity${i}" 
                                   oninput="updateRow(${i})" placeholder="0" inputmode="numeric"></td>
                        <td>
                            <input type="text" id="unit${i}" name="unit${i}" list="unit-list" 
                                   placeholder="Âçò‰Ωç" oninput="handleInput('unit${i}')" style="text-align:center;">
                        </td>
                        <td class="price-col"><input type="number" step="0.01" id="unit_price${i}" name="unit_price${i}" 
                                   oninput="updateRow(${i})" placeholder="0" inputmode="numeric"></td>
                        <td class="amount-col"><input type="number" step="0.01" id="amount${i}" name="amount${i}" 
                                   class="auto-calc" oninput="handleInput('amount${i}')" 
                                   tabindex="-1" placeholder="Ëá™ÂãïË®àÁÆó"></td>
                        <td><input type="text" id="supplier${i}" name="supplier${i}" 
                                   placeholder="‰ªïÂÖ•ÂÖà" oninput="handleInput('supplier${i}')"></td>
                        <td><input type="text" id="expected_arrival_date${i}" name="expected_arrival_date${i}" 
                                   list="arrival-list" placeholder="Êó•‰ªò/Âú®Â∫´ÂìÅ"
                                   oninput="handleInput('expected_arrival_date${i}')"></td>
                        <td><input type="text" id="remarks${i}" name="remarks${i}" 
                                   placeholder="ÂÇôËÄÉ" oninput="handleInput('remarks${i}')"></td>
                    </tr>
                `;

                // Instruction side (read-only)
                html2 += `
                    <tr class="product-row">
                        <td colspan="7">
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <span class="product-label">
                                    <span class="product-num">${i}</span>
                                    ÂìÅÂêç
                                </span>
                                <input type="text" id="product_name${i}_instruction" 
                                       class="readonly-input" style="flex: 1;" readonly>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td><input type="number" id="quantity${i}_instruction" class="readonly-input" readonly></td>
                        <td><input type="text" id="unit${i}_instruction" class="readonly-input" readonly></td>
                        <td><input type="number" id="unit_price${i}_instruction" class="readonly-input" readonly></td>
                        <td><input type="number" id="amount${i}_instruction" class="readonly-input" readonly></td>
                        <td><input type="text" id="supplier${i}_instruction" class="readonly-input" readonly></td>
                        <td><input type="text" id="expected_arrival_date${i}_instruction" class="readonly-input" readonly></td>
                        <td><input type="text" id="remarks${i}_instruction" class="readonly-input" readonly></td>
                    </tr>
                `;
            }

            tbody1.innerHTML = html1;
            tbody2.innerHTML = html2;
        }

        // ===================================
        // Default Values
        // ===================================
        function setDefaultDate() {
            const today = new Date();
            const formattedDate = formatDate(today);
            const orderDate = document.getElementById('order_date');
            if (orderDate && !orderDate.value) {
                orderDate.value = formattedDate;
                copyInput('order_date');
            }
        }

        function setInitialSerial() {
            const today = new Date();
            const yyyy = today.getFullYear();
            const mm = String(today.getMonth() + 1).padStart(2, '0');
            const dd = String(today.getDate()).padStart(2, '0');
            const serial = `${yyyy}${mm}${dd}-001`;

            const serialInput = document.getElementById('serial_no');
            if (serialInput && !serialInput.value) {
                serialInput.value = serial;
                copyInput('serial_no');
            }
        }

        function formatDate(date) {
            const yyyy = date.getFullYear();
            const mm = String(date.getMonth() + 1).padStart(2, '0');
            const dd = String(date.getDate()).padStart(2, '0');
            return `${yyyy}-${mm}-${dd}`;
        }

        // ===================================
        // Input Handling
        // ===================================
        function handleInput(id) {
            copyInput(id);
            debounceSave();
        }

        function debounceSave() {
            if (saveTimeout) {
                clearTimeout(saveTimeout);
            }
            saveTimeout = setTimeout(() => {
                saveToStorage();
            }, 500);
        }

        function copyInput(id) {
            const source = document.getElementById(id);
            const target = document.getElementById(id + '_instruction');
            if (source && target) {
                target.value = source.value;
            }
        }

        // ===================================
        // Calculations
        // ===================================
        function toHalfWidth(str) {
            if (!str) return "";
            return str.replace(/[Ôºê-ÔºôÔºé]/g, (s) => {
                return String.fromCharCode(s.charCodeAt(0) - 0xFEE0);
            });
        }

        function updateRow(index) {
            updateRowCalc(index);
            debounceSave();
        }

        function updateRowCalc(index) {
            const qtyId = 'quantity' + index;
            const priceId = 'unit_price' + index;
            const amountId = 'amount' + index;

            const qtyInput = document.getElementById(qtyId);
            const priceInput = document.getElementById(priceId);
            const amountInput = document.getElementById(amountId);

            if (!qtyInput || !priceInput || !amountInput) return;

            // Convert full-width to half-width
            if (qtyInput.value) {
                const qtyValStr = toHalfWidth(qtyInput.value);
                if (qtyInput.value !== qtyValStr) qtyInput.value = qtyValStr;
            }
            if (priceInput.value) {
                const priceValStr = toHalfWidth(priceInput.value);
                if (priceInput.value !== priceValStr) priceInput.value = priceValStr;
            }

            const qtyVal = parseFloat(qtyInput.value);
            const priceVal = parseFloat(priceInput.value);

            if (!isNaN(qtyVal) && !isNaN(priceVal)) {
                const total = qtyVal * priceVal;
                amountInput.value = Math.round(total * 100) / 100;
            } else {
                amountInput.value = '';
            }

            copyInput(qtyId);
            copyInput(priceId);
            copyInput(amountId);
            calculateTotals();
        }

        function calculateTotals() {
            let total = 0;
            for (let i = 1; i <= MAX_ROWS; i++) {
                const amountInput = document.getElementById(`amount${i}`);
                if (amountInput) {
                    const amountVal = parseFloat(amountInput.value);
                    if (!isNaN(amountVal)) {
                        total += amountVal;
                    }
                }
            }

            // Format with commas
            const formatNumber = (num) => num.toLocaleString('ja-JP');

            document.getElementById('grand_total').value = formatNumber(total);
            document.getElementById('grand_total_instruction').value = formatNumber(total);
        }

        // ===================================
        // Actions
        // ===================================
        function printForm() {
            window.focus();
            try {
                window.print();
                showToast('Âç∞Âà∑„ÉÄ„Ç§„Ç¢„É≠„Ç∞„ÇíÈñã„Åç„Åæ„Åó„Åü', 'info');
            } catch (e) {
                alert("Âç∞Âà∑Ê©üËÉΩ„ÅåÂà∂Èôê„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ„Éñ„É©„Ç¶„Ç∂„ÅÆ„É°„Éã„É•„Éº„Åã„ÇâÂç∞Âà∑„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ");
            }
        }

        function openClearModal() {
            document.getElementById('clearModal').style.display = 'flex';
        }

        function closeClearModal() {
            document.getElementById('clearModal').style.display = 'none';
        }

        function executeClear() {
            const inputs = document.querySelectorAll('input:not([readonly]), select');
            inputs.forEach(input => {
                input.value = '';
            });

            // Clear instruction side
            document.querySelectorAll('input[readonly]').forEach(input => {
                input.value = '';
            });

            setDefaultDate();
            setInitialSerial();
            calculateTotals();

            // Clear storage
            localStorage.removeItem(STORAGE_KEY);

            closeClearModal();
            showToast('ÂÖ•ÂäõÂÜÖÂÆπ„Çí„ÇØ„É™„Ç¢„Åó„Åæ„Åó„Åü', 'success');
        }
    </script>
</body>

</html>